# （21）- 逗号运算符 | 压缩代码的神器

[toc]

## 一、逗号运算符

- 今天，我们就来看下逗号运算符和逗号表达式吧。
- 在 C语言 中，可以把多个表达式用逗号连接起来，构成一个更大的表达式。其中的逗号称为 **逗号运算符**，所构成的表达式称为 **逗号表达式**。逗号表达式中用逗号分开的表达式分别求值，以最后一个表达式的值作为整个表达式的值。

> 简单来说，逗号表达式遵循两点原则：
>   1）以逗号分隔的表达式单独计算；
>   2）逗号表达式的值为最后一个表达式的值；

## 二、逗号运算符的应用

## 1、连续变量定义

- 逗号运算通常用于变量的连续定义，如下：

```c
#include <stdio.h>
int main() {
    int a = 1, b = 2, c = 3, d = 1 << 6, e;
    printf("%d\n", a + b + c + d);
    return 0;
}
```

- 这里的`int a = 1, b = 2, c = 3, d = 1 << 6, e`就是逗号表达式。

## 2、循环语句赋初值

- 逗号运算通常用于`for`结构的括号内的第一个表达式，用于给多个局部变量赋值。
- 一段对 `1`到 `10`的数求立方和的代码，如下：

```c
#include <stdio.h>
int main() {
    int i, s;
    for(i = 1, s = 0; i <= 10; ++i) {
        s += i*i*i;
    }
    printf("%d\n", s);
    return 0;
}
```

- 这里的`i = 1, s = 0`就是逗号表达式。
- 有关于`for`的内容，会在后面的章节来介绍，暂时只需要知道可以使用逗号表达式来对一些变量赋予初值。

## 3、交换变量

- 我们在实现交换变量的时候，往往需要三句话：

```c
int tmp;
tmp = a;
a = b;
b = tmp;
```

- 有了逗号表达式，我们就可以这么写：

```c
int tmp;
tmp = a, a = b, b = tmp;
```

## 三、逗号运算符注意事项

- 需要注意的是，逗号运算符的优先级非常低，甚至比赋值运算符还要低，所以当它和赋值运算符相遇时，是优先计算赋值运算的，如下代码所示：

```c
#include <stdio.h>
int main() {
    int x, y, a, b;
    a = (1, x = 2, y = 3);
    b = 1, x = 9, y = 3; 
    printf("%d %d\n", a, b);
    return 0;
}
```

- 这段代码中`a`和`b`的的赋值，只差了一个括号，但是结果截然不同。
- 输出的结果为：

```c
3 1
```

- 原因是因为`(1, x = 2, y = 3)`表达式的值为以逗号分隔的最后一个表达式的值，即`3`；而在`b = 1, x = 9, y = 3`中，由于逗号运算符的优先级很低，导致表达式分成了三部分：`b = 1`、`x = 9`、`y = 3`，所以才有 a = 3, b = 1。